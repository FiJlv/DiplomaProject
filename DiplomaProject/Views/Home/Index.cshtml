@{
    ViewData["Title"] = "Home Page";
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

    function createInputAndButton(x, y, values) {

        var input = document.createElement("input");
        input.type = "text";
        input.id = "myInput";
        input.name = "myInput";
        input.style.position = "absolute";
        input.style.top = y + "px";
        input.style.left = x + "px";
        input.value = "";
        document.body.appendChild(input);

        var button = document.createElement("button");
        button.innerText = "Show Graph";
        button.style.position = "absolute";
        button.style.top = (y + 30) + "px";
        button.style.left = x + "px";
        button.type = "button";
        document.body.appendChild(button);
        input.focus();

        var valuesArr = values.split(",").map(function (num) {
            return parseInt(num.trim(), 10);
        });

        button.addEventListener("click", function () {
            var canvas = document.createElement("canvas");
            canvas.width = 200;
            canvas.height = 200;
            canvas.style.position = "absolute";
            canvas.style.top = (y + 45) + "px";
            canvas.style.left = x + "px";

            document.body.appendChild(canvas);

            var data = {
                labels: ["1s", "2s", "3s", "4s", "5s", "6s", "7s", "8s", "9s", "10s",
                    "11s", "12s", "13s", "14s", "15s", "16s", "17s", "18s", "19s", "20s",
                    "21s", "22s", "23s", "24s", "25s", "26s", "27s", "28s", "29s", "30s"],
                datasets: [{
                    label: "Temperature",
                    backgroundColor: "rgba(153, 102, 255, 0.1)",
                    borderColor: "rgba(153, 102, 255, 0.5)",
                    borderWidth: 1,
                    data: /*[]*/ valuesArr
                }]
            };

            var chart = new Chart(canvas, {
                type: "line",
                data: data,
                options: {
                    responsive: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
            //var currentIndex = 0;
            //var intervalId = setInterval(function () {
            //    if (currentIndex < valuesArr.length) {
            //        input.value = valuesArr[currentIndex];
            //        chart.data.datasets[0].data.push(valuesArr[currentIndex]);
            //        chart.update();
            //        currentIndex++;
            //    } else {
            //        clearInterval(intervalId);
            //    }
            //}, 1000);
        });

        var currentIndex = 0;
        var intervalId = setInterval(function () {
            if (currentIndex < valuesArr.length) {
                input.value = valuesArr[currentIndex];
                currentIndex++;
            } else {
                clearInterval(intervalId);
            }
        }, 1000);
    }

    $(document).ready(function () {
        $.ajax({
            url: "/Home/GetIndicators",
            type: "GET",
            success: function (data) {
                data.forEach(function (indicator) {
                    createInputAndButton(indicator.x, indicator.y, indicator.temperatureValues);
                });
            }
        });
    });

    document.addEventListener("click", function (event) {
        if (event.target.tagName !== "INPUT" && event.target.tagName !== "BUTTON") {

            var x = event.clientX;
            var y = event.clientY;

            $.ajax({
                url: "/Home/GenerateValues",
                type: "GET",
                success: function (values) {
                    createInputAndButton(x, y, values);

                    $.ajax({
                        url: "/Home/SaveInput",
                        type: "POST",
                        data: {
                            x: x,
                            y: y,
                            temperatureValues: values
                        }
                    });
                }
            });
        }
    });

</script>

<div class="text-center">

    <form method="post" enctype="multipart/form-data" action="@Url.Action("UploadBackground", "Home")">
        <input type="file" name="imageFile" /><button>Upload</button>
    </form>


    <img src="@Url.Action("GetBackgroundImage", "Home", new { id = 2 })" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;" />

    <table class="table">
        <tr><th>X</th><th>Y</th><th>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.X</td>
                <td>@item.Y</td>

                <td>
                    <form asp-controller="Home" asp-action="Delete" method="post"  asp-route-id="@item.Id">
                        <input type="submit" value="Delete" />
                    </form>
                </td>
            </tr>
        }
    </table>
</div>
